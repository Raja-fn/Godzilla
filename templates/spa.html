{% extends 'base.html' %}
{% block content %}
<section class="spa-page py-4">
  <div class="container-fluid">
    <div class="d-flex align-items-center mb-4">
      <div class="p-3 bg-primary text-white rounded-circle me-3">
        <i class="fas fa-microchip"></i>
      </div>
      <div>
        <h1 class="h3 fw-bold mb-0">System Live Feed</h1>
        <p class="text-muted mb-0">Real-time synchronization with AI Agent and Data Pipelines</p>
      </div>
    </div>

    <div id="app">
      <div class="d-flex justify-content-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
  </div>
</section>

<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script>
  const e = React.createElement;
  function App() {
    const [logs, setLogs] = React.useState([]);
    const [decisions, setDecisions] = React.useState([]);
    const [loading, setLoading] = React.useState(true);

    React.useEffect(() => {
      Promise.all([
        fetch('/api/logs').then(r => r.json()),
        fetch('/api/decisions').then(r => r.json())
      ]).then(([l, d]) => {
        setLogs(l);
        setDecisions(d);
        setLoading(false);
      });
    }, []);

    if (loading) return e('div', { className: 'text-center py-5' }, 'Initializing Feed...');

    return e('div', { className: 'row g-4' },
      e('div', { className: 'col-lg-6' },
        e('div', { className: 'card p-4 border-0 shadow-sm', style: { borderRadius: '24px' } },
          e('h5', { className: 'fw-bold mb-4 d-flex justify-content-between' },
            'Raw Health Stream',
            e('span', { className: 'badge bg-success small' }, 'LIVE')
          ),
          logs.length === 0 ? e('p', { className: 'text-muted small' }, 'No data in stream.') :
            logs.slice(0, 10).map((log, idx) => e('div', { key: idx, className: 'p-3 mb-2 border rounded-4 bg-light', style: { fontSize: '0.85rem' } },
              e('div', { className: 'd-flex justify-content-between' },
                e('span', { className: 'fw-bold text-primary' }, log.date),
                e('span', { className: 'text-muted extra-small' }, log.mood || 'unspecified')
              ),
              e('div', { className: 'mt-1' }, `Sleep: ${log.sleep_hours}h | Energy: ${log.energy_level} | Stress: ${log.stress_level}`)
            ))
        )
      ),
      e('div', { className: 'col-lg-6' },
        e('div', { className: 'card p-4 border-0 shadow-sm', style: { borderRadius: '24px' } },
          e('h5', { className: 'fw-bold mb-4 d-flex justify-content-between' },
            'Agent Pulse',
            e('span', { className: 'badge bg-primary small' }, 'CONNECTED')
          ),
          decisions.length === 0 ? e('p', { className: 'text-muted small' }, 'Agent is idle.') :
            decisions.slice(0, 5).map((d, idx) => e('div', { key: idx, className: 'p-3 mb-2 border-start border-4 border-primary bg-white rounded-end shadow-sm', style: { fontSize: '0.85rem' } },
              e('div', { className: 'fw-bold mb-1' }, `Decision Date: ${d.date}`),
              e('div', { className: 'text-muted small' }, d.final_plan)
            ))
        )
      )
    );
  }
  ReactDOM.createRoot(document.getElementById('app')).render(e(App));
</script>

<style>
  .extra-small {
    font-size: 0.7rem;
  }

  .spa-page .card {
    transition: transform 0.3s;
  }

  .spa-page .card:hover {
    transform: translateY(-5px);
  }
</style>
{% endblock %}